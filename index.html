<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã–dev Takip Sistemi - Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>
    
    <style>
        /* SAF CSS: Durum Butonu Stilleri */
        .status-cell { 
            padding: 8px; 
            white-space: nowrap;
        }

        .status { 
            cursor: pointer; 
            border-radius: 6px; 
            padding: 8px 6px; /* Dikey padding rahatlatÄ±ldÄ± */
            color: white; 
            transition: background-color 0.15s ease-in-out;
            font-weight: 500;
            font-size: 0.75rem; /* text-xs'e geri dÃ¶ndÃ¼ */
            line-height: 1;
            width: 100%; 
            min-width: 5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* RENKLER */
        .YapmadÄ± { background-color: #dc2626; } 
        .YapmadÄ±:hover { background-color: #b91c1c; } 
        .Eksik { background-color: #f59e0b; } 
        .Eksik:hover { background-color: #d97706; } 
        .YaptÄ± { background-color: #16a34a; } 
        .YaptÄ±:hover { background-color: #15803d; } 
        .Gelmedi { background-color: #9333ea; } 
        .Gelmedi:hover { background-color: #7e22ce; } 
        .KitapYok { background-color: #374151; } 
        .KitapYok:hover { background-color: #1f2937; }
        
        /* DÃ¼zenlenebilir HÃ¼creler ve Focus Stili */
        .editable { background-color: #fff7e6; }
        [contenteditable]:focus { outline: 2px solid #3b82f6; outline-offset: 0; }
        
        /* Flatpickr iÃ§in hafif stil ayarlamalarÄ± (isteÄŸe baÄŸlÄ±) */
        .flatpickr-input { 
            background-color: transparent !important;
            border: none !important;
            width: 100%;
            cursor: pointer;
            text-align: left;
            padding: 0;
            outline: none !important;
        }

    </style>
</head>
<body class="font-sans bg-gray-100 p-5 md:p-10">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">ðŸ“š Ã–dev Takip Sistemi</h1>
	<div id="saveNotification" class="fixed top-5 right-5 z-50 bg-green-500 text-white p-3 rounded-lg shadow-xl transition-opacity duration-300 opacity-0 pointer-events-none">
		âœ“ Kaydedildi!
	</div>
<div class="bg-white p-4 rounded-lg shadow-md mb-6 flex flex-wrap gap-3 items-center">
        
        <input type="text" id="newClassName" placeholder="Yeni SÄ±nÄ±f AdÄ±" 
               class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 flex-grow min-w-[150px]">
        
        <button id="btnAddClass" 
                class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition duration-150">
            SÄ±nÄ±f Ekle
        </button>
        
        <select id="classSelect" 
                class="p-2 border border-gray-300 rounded-lg bg-white focus:ring-blue-500 focus:border-blue-500 min-w-[150px]"></select>
        
        <button id="btnEditClass" 
                class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition duration-150">
            SÄ±nÄ±f AdÄ±nÄ± DÃ¼zenle
        </button>
        
        <input type="text" id="newStudent" placeholder="Yeni Ã–ÄŸrenci AdÄ±" 
               class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 flex-grow min-w-[150px]">
        
        <button id="btnAddStudent" 
                class="bg-teal-600 text-white p-2 rounded-lg hover:bg-teal-700 transition duration-150">
            Ã–ÄŸrenci Ekle
        </button>
    </div>

	<div class="add-homework bg-white p-4 rounded-lg shadow-md mb-6 flex flex-wrap gap-3 items-center">
			
			<input type="text" id="source" placeholder="Kaynak" 
				   class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 flex-grow min-w-[150px]">
				   
			<input type="text" id="topic" placeholder="Konu" 
				   class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 flex-grow min-w-[150px]">
				   
			<input type="text" id="pages" placeholder="Sayfa" 
				   class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-28"> 
				   
			<button id="btnAddHomework" 
					class="bg-emerald-600 text-white p-2 rounded-lg hover:bg-emerald-700 transition duration-150 w-28">
				Ã–devi Ekle
			</button>
		</div>

	<div id="tableHeaderArea" class="mt-4 mb-3 flex justify-between items-center p-2 bg-white rounded-lg shadow-md">
			
			<h2 id="currentClassNameDisplay" class="text-xl font-bold text-gray-700">LÃ¼tfen Bir SÄ±nÄ±f SeÃ§in</h2>
			
			<div class="flex gap-3">
				<button id="btnExportJSON" class="bg-gray-600 text-white p-2 rounded-lg text-sm hover:bg-gray-700 transition duration-150">JSON Aktar</button>
				<button id="btnExportCSV" class="bg-gray-600 text-white p-2 rounded-lg text-sm hover:bg-gray-700 transition duration-150">Excel (CSV) Aktar</button>
			</div>
		</div>
		


    <div class="overflow-x-auto shadow-lg rounded-lg">
        <table id="homeworkTable" class="min-w-full divide-y divide-gray-200">
            <thead id="tableHead" class="bg-blue-600">
            </thead>
            <tbody id="homeworkBody" class="bg-white divide-y divide-gray-200">
            </tbody>
        </table>
    </div>

    <script>
		let classes; 
		let currentClass = '';
        document.addEventListener('DOMContentLoaded', function(){
		
            classes = JSON.parse(localStorage.getItem('classes') || '{}');
            
            const statuses = ["YapmadÄ±","YaptÄ±","Eksik","Gelmedi","KitapYok"];

            function saveData(){ localStorage.setItem('classes', JSON.stringify(classes)); 
				
                // YENÄ° KOD: Kaydedildi Bildirimi
                const notification = document.getElementById('saveNotification');
                notification.classList.remove('opacity-0', 'bg-red-500'); // Hata rengini kaldÄ±r (varsa)
                notification.classList.add('opacity-100', 'bg-green-500');
                
                // 1.5 saniye sonra bildirimi gizle
                setTimeout(() => {
                    notification.classList.remove('opacity-100');
                    notification.classList.add('opacity-0');
                }, 1500);
			}

            // TARÄ°H YARDIMCI FONKSÄ°YONLARI
            function getIsoDate(date) {
                return date.toISOString().split('T')[0];
            }

            const monthNames = ["Oca", "Åžub", "Mar", "Nis", "May", "Haz", "Tem", "AÄŸu", "Eyl", "Eki", "Kas", "Ara"];
            const dayNames = ["Paz", "Pzt", "Sal", "Ã‡ar", "Per", "Cum", "Cmt"];

            function formatDateToTurkish(isoDateString) {
                if (!isoDateString) return '';
                const parts = isoDateString.split('-');
                if (parts.length !== 3) return isoDateString; 

                const date = new Date(isoDateString);
                date.setMinutes(date.getMinutes() + date.getTimezoneOffset()); 

                const dayOfMonth = date.getDate();
                const month = monthNames[date.getMonth()];
                const dayOfWeek = dayNames[date.getDay()];
                
                return `${dayOfMonth} ${month}. ${dayOfWeek}`;
            }

            function updateClassSelect(selectValue){
                // ... (SÄ±nÄ±f SeÃ§im MantÄ±ÄŸÄ±) ...
                const select = document.getElementById('classSelect');
                const prev = selectValue !== undefined ? selectValue : select.value;
                
                select.innerHTML = '<option value="">-- SÄ±nÄ±f SeÃ§ --</option>' + Object.keys(classes).map(cls=>`<option value="${cls}">${cls}</option>`).join('');
                
                if(prev && classes[prev]){
                    select.value = prev;
                    currentClass = prev;
                } else {
                    select.value = '';
                    currentClass = '';
                }
            }

            function renderTable(){
                 const tbody=document.getElementById('homeworkBody');
                const thead=document.getElementById('tableHead');
                const display = document.getElementById('currentClassNameDisplay');
                const tableHeaderArea = document.getElementById('tableHeaderArea');
                
                // Tabloyu her zaman temizle
                thead.innerHTML = '';
                tbody.innerHTML = ''; 

                // SÄ±nÄ±f SeÃ§ili DeÄŸilse BaÅŸlÄ±ÄŸÄ± GÃ¼ncelle ve Durdur
                if(!currentClass || !classes[currentClass]){
                    display.innerText = 'LÃ¼tfen Bir SÄ±nÄ±f SeÃ§in';
                    tableHeaderArea.classList.add('hidden'); 
                    return; 
                }
                
                // SÄ±nÄ±f SeÃ§ili Ä°se BaÅŸlÄ±ÄŸÄ± GÃ¼ncelle ve Tabloyu OluÅŸturmaya BaÅŸla
                tableHeaderArea.classList.remove('hidden');
                display.innerText = `${currentClass} SÄ±nÄ±fÄ± Ã–dev Takibi`;
               
                
                // ... (Tablo BaÅŸlÄ±ÄŸÄ± OluÅŸturma MantÄ±ÄŸÄ±) ...
                const studentHeaders = classes[currentClass].students.map((s,i) => 
                    `<th class="px-2 py-3 text-xs font-semibold uppercase tracking-wider text-white bg-blue-700 cursor-pointer" data-index='${i}' title="Ã–ÄŸrenci adÄ±nÄ± dÃ¼zenlemek iÃ§in Ã§ift tÄ±klayÄ±n">${s}</th>`
                ).join('');
                
                thead.innerHTML = `
                    <tr>
                        <th class="px-2 py-3 text-left text-xs font-semibold uppercase tracking-wider text-white">#</th>
                        <th class="px-2 py-3 text-left text-xs font-semibold uppercase tracking-wider text-white">Kaynak</th>
                        <th class="px-2 py-3 text-left text-xs font-semibold uppercase tracking-wider text-white">Konu</th>
                        <th class="px-2 py-3 text-left text-xs font-semibold uppercase tracking-wider text-white">Sayfa</th>
                        <th class="px-2 py-3 text-left text-xs font-semibold uppercase tracking-wider text-white">VeriliÅŸ</th>
                        <th class="px-2 py-3 text-left text-xs font-semibold uppercase tracking-wider text-white">Kontrol</th>
                        ${studentHeaders}
                    </tr>
                `;


                // Tablo Ä°Ã§eriÄŸini OluÅŸtur
                classes[currentClass].homeworks.forEach((hw,hwIndex)=>{
                    const row=document.createElement('tr');
                    row.classList.add('hover:bg-gray-50');

                    // Tarih HÃ¼creleri iÃ§in INPUT alanÄ± oluÅŸturuldu
                    const givenDateInput = `<input type="text" readonly class="flatpickr-input" data-date-field="givenDate" data-hw='${hwIndex}' value="${formatDateToTurkish(hw.givenDate) || ''}">`;
                    const checkDateInput = `<input type="text" readonly class="flatpickr-input" data-date-field="checkDate" data-hw='${hwIndex}' value="${formatDateToTurkish(hw.checkDate) || ''}">`;


                    // Ã–dev Bilgileri SÃ¼tunlarÄ±
                    const hwCells = `
                        <td class="px-2 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${hwIndex+1}</td>
                        <td contenteditable class='editable px-2 py-2 whitespace-nowrap text-sm text-gray-700' data-field='source' data-index='${hwIndex}' data-type='text'>${hw.source || ''}</td>
                        <td contenteditable class='editable px-2 py-2 whitespace-nowrap text-sm text-gray-700' data-field='topic' data-index='${hwIndex}' data-type='text'>${hw.topic || ''}</td>
                        <td contenteditable class='editable px-2 py-2 whitespace-nowrap text-sm text-gray-700' data-field='pages' data-index='${hwIndex}' data-type='text'>${hw.pages || ''}</td>
                        
                        <td class="px-2 py-2 whitespace-nowrap text-sm text-gray-700 date-cell" data-field='givenDate' data-index='${hwIndex}'>${givenDateInput}</td>
                        <td class="px-2 py-2 whitespace-nowrap text-sm text-gray-700 date-cell" data-field='checkDate' data-index='${hwIndex}'>${checkDateInput}</td>
                    `;
                    
                    // Ã–ÄŸrenci Durum SÃ¼tunlarÄ±
                    const statusCells = hw.statuses.map((status,studentIndex) => 
                        `<td class="status-cell"><div class="status ${status}" data-hw='${hwIndex}' data-student='${studentIndex}'>${status}</div></td>`
                    ).join('');

                    row.innerHTML = hwCells + statusCells;
                    tbody.appendChild(row);
                });


                // 1. DÃ¼z Metin AlanlarÄ± DÃ¼zenleme (Ã‡ift TÄ±klama)
                document.querySelectorAll('.editable').forEach(cell=>{
                    cell.setAttribute('contenteditable', 'false');

                    cell.removeEventListener('blur', cell._blurHandler);
                    cell.removeEventListener('keydown', cell._keyHandler);
                    cell.removeEventListener('dblclick', cell._dblclickHandler);

                    cell._blurHandler = function(){
                        const index = this.dataset.index;
                        const field = this.dataset.field;
                        classes[currentClass].homeworks[index][field] = this.innerText.trim();
                        saveData();
                        this.setAttribute('contenteditable', 'false');
                    };
                    
                    cell._keyHandler = function(e){
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.blur();
                        }
                    };
                    
                    cell._dblclickHandler = function(){
                        this.setAttribute('contenteditable', 'true');
                        this.focus();
                    };

                    cell.addEventListener('blur', cell._blurHandler);
                    cell.addEventListener('keydown', cell._keyHandler);
                    cell.addEventListener('dblclick', cell._dblclickHandler); 
                });
                
                // 2. Durum DeÄŸiÅŸtirme (Tek TÄ±klama)
                // ... (Ã–nceki mantÄ±k aynÄ± kalÄ±r) ...
                document.querySelectorAll('.status').forEach(cell=>{
                    cell.removeEventListener('click', cell._clickHandler);
                    cell._clickHandler = function(){
                        const hwIndex = Number(this.dataset.hw);
                        const studentIndex = Number(this.dataset.student);
                        
                        const oldStatus = classes[currentClass].homeworks[hwIndex].statuses[studentIndex];
                        let current = statuses.indexOf(oldStatus);
                        
                        current = (current + 1) % statuses.length;
                        const newStatus = statuses[current];
                        
                        classes[currentClass].homeworks[hwIndex].statuses[studentIndex] = newStatus;
                        saveData();
                        
                        this.classList.remove(oldStatus); 
                        this.classList.add(newStatus); 
                        this.innerText = newStatus;
                    };
                    cell.addEventListener('click', cell._clickHandler);
                });

                // 3. Ã–ÄŸrenci AdÄ± DÃ¼zenleme (Ã‡ift TÄ±klama)
                // ... (Ã–nceki mantÄ±k aynÄ± kalÄ±r) ...
                document.querySelectorAll('#tableHead th[data-index]').forEach(th=>{
                    th.removeEventListener('dblclick', th._dblHandler);
                    th._dblHandler = function(){
                        const index = Number(this.dataset.index);
                        const oldName = classes[currentClass].students[index];
                        const newName = prompt('Yeni Ã¶ÄŸrenci adÄ±:', oldName);
                        if(newName && newName.trim() !== oldName){
                            classes[currentClass].students[index] = newName.trim();
                            saveData(); renderTable();
                        }
                    };
                    th.addEventListener('dblclick', th._dblHandler);
                });
                
                // 4. Flatpickr (Tarih) Entegrasyonu
                document.querySelectorAll('.flatpickr-input').forEach(input => {
                    const hwIndex = Number(input.dataset.hw);
                    const field = input.dataset.dateField;
                    
                    // Flatpickr'Ä± baÅŸlat
                    flatpickr(input, {
                        locale: 'tr', // TÃ¼rkÃ§e dil
                        defaultDate: classes[currentClass].homeworks[hwIndex][field], // Mevcut ISO tarihi
                        dateFormat: "Y-m-d", // VeritabanÄ± (localStorage) formatÄ±
                        altInput: true,
                        altFormat: "j M. D", // GÃ¶rÃ¼nen format: 17 Tem. SalÄ±
                        
                        // Tarih seÃ§ildiÄŸinde
                        onClose: function(selectedDates, dateStr, instance) {
                            if (selectedDates.length > 0) {
                                // Yeni tarihi kaydet
                                classes[currentClass].homeworks[hwIndex][field] = dateStr;
                                saveData();
                                
                                // DOM'u manuel olarak gÃ¼ncelle (Flatpickr, altInput'u kullandÄ±ÄŸÄ± iÃ§in otomatik gÃ¼nceller)
                                // Not: Yine de tutarlÄ± olmak iÃ§in renderTable() Ã§aÄŸrÄ±labilir, ancak bu performansÄ± etkiler.
                                // Sadece bu hÃ¼crenin gÃ¼ncellenmesi yeterlidir.
                            }
                        }
                    });
                });

            }

            function loadClass(){
                currentClass = document.getElementById('classSelect').value;
                renderTable();
            }

            // ... (addClass, editClass, addStudent fonksiyonlarÄ± aynÄ± kalÄ±r) ...
            
            function addClass(){
                const nameInput = document.getElementById('newClassName');
                const name = nameInput.value.trim();
                if(!name){ alert('LÃ¼tfen bir sÄ±nÄ±f adÄ± girin.'); return; }
                if(!classes[name]){
                    classes[name] = { students: [], homeworks: [] };
                    updateClassSelect(name); 
                    document.getElementById('classSelect').value = name;
                    currentClass = name; 
                    renderTable(); saveData();
                } else {
                    alert(`'${name}' adÄ±nda bir sÄ±nÄ±f zaten mevcut.`);
                }
                nameInput.value = '';
            }
            
            function editClass(){
                if(!currentClass){ alert('Ã–nce dÃ¼zenlemek istediÄŸiniz sÄ±nÄ±fÄ± seÃ§in.'); return; }
                const newName = prompt('Yeni sÄ±nÄ±f adÄ±:', currentClass);
                if(newName && newName.trim() !== currentClass && !classes[newName.trim()]){
                    classes[newName.trim()] = classes[currentClass];
                    delete classes[currentClass];
                    updateClassSelect(newName.trim());
                    document.getElementById('classSelect').value = newName.trim();
                    currentClass = newName.trim();
                    saveData(); renderTable();
                } else if (newName && newName.trim() !== currentClass) {
                    alert(`'${newName.trim()}' adÄ±nda bir sÄ±nÄ±f zaten mevcut veya boÅŸ bir isim girdiniz.`);
                }
            }

            function addStudent(){
                if(!currentClass){ alert('Ã–nce Ã¶ÄŸrenci eklemek istediÄŸiniz sÄ±nÄ±fÄ± seÃ§in.'); return; }
                const nameInput = document.getElementById('newStudent');
                const name = nameInput.value.trim();
                
                if(!name){ alert('LÃ¼tfen bir Ã¶ÄŸrenci adÄ± girin.'); return; }
                
                if(!classes[currentClass].students.includes(name)){
                    classes[currentClass].students.push(name);
                    classes[currentClass].homeworks.forEach(hw => hw.statuses.push('YapmadÄ±')); 
                    saveData(); 
                    renderTable(); 
                } else {
                    alert(`'${name}' adlÄ± Ã¶ÄŸrenci zaten bu sÄ±nÄ±fta.`);
                }
                nameInput.value = '';
            }


            // Ã–dev Ekleme (BasitleÅŸtirildi: Tarih otomatik atanacak)
            function addHomework(){
                if(!currentClass){ alert('Ã–nce Ã¶dev eklemek istediÄŸiniz sÄ±nÄ±fÄ± seÃ§in.'); return; }
                
                const sourceInput = document.getElementById('source');
                const topicInput = document.getElementById('topic');
                const pagesInput = document.getElementById('pages');

                const source = sourceInput.value.trim();
                const topic = topicInput.value.trim();
                const pages = pagesInput.value.trim();
                
                if(!source || !topic || !pages){ alert('Kaynak, Konu ve Sayfa alanlarÄ±nÄ± doldurun.'); return; }
                
                // Tarihleri Otomatik Olarak Ata (BugÃ¼n ve 7 gÃ¼n sonrasÄ±)
                let givenDateObj = new Date();
                let givenDate = getIsoDate(givenDateObj);
                
                let checkDateObj = new Date(givenDateObj);
                checkDateObj.setDate(givenDateObj.getDate() + 7);
                let checkDate = getIsoDate(checkDateObj);
                
                const hw = { 
                    source, 
                    topic, 
                    pages, 
                    givenDate, // ISO formatÄ±nda sakla
                    checkDate, // ISO formatÄ±nda sakla
                    statuses: classes[currentClass].students.map(()=> 'YapmadÄ±') 
                };
                
                classes[currentClass].homeworks.push(hw);
                saveData(); 
                renderTable(); 
                
                // Form alanlarÄ±nÄ± temizle
                sourceInput.value = '';
                topicInput.value = '';
                pagesInput.value = '';
            }
            
            // ... (exportJSON ve exportCSV fonksiyonlarÄ± aynÄ± kalÄ±r) ...
           function exportJSON(){
                if(!Object.keys(classes).length){ 
                    alert('KaydedilmiÅŸ veri bulunmamaktadÄ±r.'); return; 
                }
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(classes, null, 2));
                
                const dl = document.createElement('a'); 
                dl.href = dataStr; 
                dl.download = 'odev_takip_tum_siniflar_' + new Date().toISOString().split('T')[0] + '.json'; 
                document.body.appendChild(dl); // Chrome/Edge iÃ§in bazen gerekli
                dl.click();
                document.body.removeChild(dl);
            }

            function exportCSV(){
                if(!currentClass){ 
                    alert('LÃ¼tfen Ã¶nce dÄ±ÅŸa aktarmak istediÄŸiniz sÄ±nÄ±fÄ± seÃ§in.'); 
                    return; 
                }

                // UTF-8 BOM, TÃ¼rkÃ§e karakterlerin Excel'de dÃ¼zgÃ¼n gÃ¶rÃ¼nmesi iÃ§in Ã¶nemlidir
                const BOM = "\uFEFF"; 
                
                const header = ['#','Kaynak','Konu','Sayfa','VeriliÅŸ Tarihi','Kontrol Tarihi', ...classes[currentClass].students];
                
                const rows = classes[currentClass].homeworks.map((hw, idx) => {
                    const pagesValue = (hw.pages || '').includes('-') || (hw.pages || '').includes('/') ? "'" + hw.pages : hw.pages;
                    
                    return [
                        idx+1, 
                        hw.source, 
                        hw.topic, 
                        pagesValue, // Sayfa NumarasÄ± iÃ§in Ã¶zel kontrol
                        hw.givenDate, 
                        hw.checkDate, 
                        ...hw.statuses
                    ];
                });
               // VirgÃ¼l, tÄ±rnak iÅŸareti ve yeni satÄ±r karakterlerini temizle ve tÄ±rnak iÃ§ine al
Â  Â  Â  Â  Â  Â  Â  Â  const cleanAndQuote = (val) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(val === null || val === undefined) return '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const strVal = String(val).replace(/\n/g, ' ').trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `"${strVal.replace(/"/g, '""')}"`;
Â  Â  Â  Â  Â  Â  Â  Â  };
                
               const csv = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  header.map(cleanAndQuote).join(';'), 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...rows.map(r => r.map(cleanAndQuote).join(';'))
Â  Â  Â  Â  Â  Â  Â  Â  ].join('\n');
                
               // Yeni Blob/URL yÃ¶ntemi daha gÃ¼venilirdir.
Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
Â  Â  Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const dl = document.createElement('a');Â 
Â  Â  Â  Â  Â  Â  Â  Â  dl.href = url;Â 
Â  Â  Â  Â  Â  Â  Â  Â  dl.download = `${currentClass}_odev_takip_${new Date().toISOString().split('T')[0]}.csv`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(dl);
Â  Â  Â  Â  Â  Â  Â  Â  dl.click();
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(dl);
Â  Â  Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url); // BelleÄŸi temizle
            }


            // Olay Dinleyicileri
            document.getElementById('btnAddClass').addEventListener('click', addClass);
            document.getElementById('btnEditClass').addEventListener('click', editClass);
            document.getElementById('btnAddStudent').addEventListener('click', addStudent);
            document.getElementById('btnAddHomework').addEventListener('click', addHomework);
            document.getElementById('btnExportJSON').addEventListener('click', exportJSON);
            document.getElementById('btnExportCSV').addEventListener('click', exportCSV);
            document.getElementById('classSelect').addEventListener('change', loadClass);

            // BaÅŸlangÄ±Ã§ MantÄ±ÄŸÄ±
            updateClassSelect();
            if(currentClass) loadClass(); else renderTable();
        });
    </script>
</body>
</html>